!function(e,t){"function"==typeof define&&define.amd?define(["dependency"],t):"object"==typeof module&&module.exports?module.exports=t(require("dependency")):e.returnExports=t(e.dependency)}(this,function(e){"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function a(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function s(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function o(e){var i="function"==typeof Map?new Map:void 0;return(o=function(e){if(null===e||(t=e,-1===Function.toString.call(t).indexOf("[native code]")))return e;var t;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==i){if(i.has(e))return i.get(e);i.set(e,n)}function n(){return u(e,arguments,l(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),c(n,e)})(e)}function u(e,t,n){return(u=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}()?Reflect.construct:function(e,t,n){var i=[null];i.push.apply(i,t);var a=new(Function.bind.apply(e,i));return n&&c(a,n.prototype),a}).apply(null,arguments)}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}customElements.define("fm-imgprev",function(){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=s(this,l(t).call(this))).CONNECTED=!1,e.WRAPPER=void 0,e.LABEL_CLASS="fm-imgprev-label",e.HOLDER_CLASS="fm-imgprev-wrapper",e.PREVIEW_CLASS="fm-imgprev-preview",e.ACTIONS_CLASS="fm-imgprev-actions",e}var e,n,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(t,o(HTMLInputElement)),e=t,i=[{key:"observedAttributes",get:function(){return["data-width","data-height","data-placeholder","data-fake-btn","data-fake-btn-classes"]}}],(n=[{key:"attributeChangedCallback",value:function(e,t,n){"data-width"!=(e=e.toLowerCase())&&"data-height"!=e||this.resize(),"data-placeholder"==e&&this.updateLabel(this.dataset.placeholder),"data-fake-btn"==e&&this.updateFakeBtnText(this.dataset.fakeBtn),"data-fake-btn-classes"==e&&this.updateFakeBtnClasses(t,n)}},{key:"connectedCallback",value:function(){this.CONNECTED||this.connect()}},{key:"validateElement",value:function(){var e=this.getAttribute("type");e&&"file"==e.toLowerCase()||console.warn("fm-imgprev element must be an input type file")}},{key:"connect",value:function(){this.CONNECTED=!0,this.validateElement(),this.wrap(),this.listen()}},{key:"wrap",value:function(){if(!this.WRAPPER){var e=document.createElement("div");e.classList.add(this.HOLDER_CLASS),e.style.width=this.dataset.width||"100%",e.style.height=this.dataset.height||"100%",this.dataset.fakeBtn&&(e.dataset.fakeBtn=this.dataset.fakebtn),this.parentElement.insertBefore(e,this),this.WRAPPER=e,this.addPreviewer(),this.addActions()}}},{key:"addActions",value:function(){var e=document.createElement("div");e.classList.add(this.ACTIONS_CLASS),e.append(this),e.append(this.createFakeBtn()),e.append(this.createB64ImgInput()),this.WRAPPER.append(e)}},{key:"addPreviewer",value:function(){if(this.WRAPPER){var e=document.createElement("div");e.classList.add(this.PREVIEW_CLASS),e.setAttribute("data-placeholder",this.dataset.placeholder||""),e.append(this.createPreviewImg()),this.dataset.persistent||e.append(this.createPreviewCloseBtn()),this.WRAPPER.prepend(e)}}},{key:"createPreviewImg",value:function(){var e=document.createElement("img"),t=this.dataset.initialImg;return t&&(e.src=t),e}},{key:"createFakeBtn",value:function(){var e,t=this,n=document.createElement("button"),i=this.dataset.fakeBtnClasses?this.dataset.fakeBtnClasses.split(" "):"";return n.innerText=this.dataset.fakeBtn||"Upload Image",n.classList.add("fm-imgprev-fake-btn"),i&&(e=n.classList).add.apply(e,r(i)),n.addEventListener("click",function(){return t.click()}),n}},{key:"createB64ImgInput",value:function(){var e=document.createElement("input");return e.setAttribute("type","text"),e.setAttribute("hidden","true"),e.classList.add("fm-imgprev-b64-input"),e.setAttribute("name","".concat(this.name,"_base64")),e.value=this.dataset.base64Input||"",e}},{key:"createPreviewCloseBtn",value:function(){var e=this,t=document.createElement("span");return t.classList.add("close"),t.addEventListener("click",function(){return e.resetState()}),t}},{key:"updateLabel",value:function(e){this.WRAPPER&&e&&(this.WRAPPER.querySelector(".".concat(this.PREVIEW_CLASS)).dataset.placeholder=e)}},{key:"updateFakeBtnText",value:function(e){this.WRAPPER&&e&&(this.WRAPPER.querySelector(".fm-imgprev-fake-btn").innerText=e)}},{key:"updateFakeBtnClasses",value:function(e,t){if(this.WRAPPER){var n,i,a=this.WRAPPER.querySelector(".fm-imgprev-fake-btn");if(e.length)(n=a.classList).remove.apply(n,r(e.split(" ")));if(t.length)(i=a.classList).add.apply(i,r(t.split(" ")))}}},{key:"resize",value:function(){this.WRAPPER&&(this.parentElement.style.width=this.dataset.width||"100%",this.parentElement.style.height=this.dataset.height||"100%")}},{key:"isLoading",value:function(e){this.WRAPPER&&this.WRAPPER.classList[e?"add":"remove"]("loading")}},{key:"listen",value:function(){var r=this;this.addEventListener("change",function(e){r.isLoading(!0);var t=e.target.files,n=new FileReader,i=+r.dataset.maxSize,a=+r.dataset.minSize;t&&t[0]?(n.onload=function(e){if(!r.validateImgSize(t[0].size,a,i))return!1;r.updatePreviewImage(e.target.result)},n.onerror=function(e){console.error(e)},n.onloadend=function(){r.isLoading(!1)},n.readAsDataURL(t[0])):r.resetState()})}},{key:"validateImgSize",value:function(e,t,n){return n&&this.bytesToSize(e)>n?(this.value="",this.isLoading(!1),console.error(this.dataset.maxSizeError),!1):!(t&&e<t)||(this.value="",this.isLoading(!1),console.error(this.dataset.minSizeError),!1)}},{key:"updatePreviewImage",value:function(e){this.WRAPPER.querySelector(".".concat(this.PREVIEW_CLASS," img")).src=e,this.WRAPPER.querySelector(".fm-imgprev-b64-input").value=e,this.isLoading(!1),this.execInlineEvent("data-on:image")}},{key:"resetState",value:function(){this.value="",this.isLoading(!1),this.WRAPPER.querySelector(".fm-imgprev-b64-input").value="",this.WRAPPER.querySelector(".".concat(this.PREVIEW_CLASS," img")).removeAttribute("src"),this.execInlineEvent("data-on:reset")}},{key:"bytesToSize",value:function(e){return(e/1048576).toFixed(2)}},{key:"execInlineEvent",value:function(e){if(!this.getAttribute(e))return null;window[this.getAttribute(e).split("(")[0].trim()](this)}}])&&a(e.prototype,n),i&&a(e,i),t}(),{extends:"input"})});